<!doctype html>
<html>
  <head>
    <title>HN</title>
    <meta name="description" content="Hacker News PWA" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link href="https://fonts.googleapis.com/css?family=Kanit:500,800|Lato&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <link rel="apple-touch-icon" href="/icons/icon-512x512.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png" />
    <link rel="apple-touch-icon" sizes="128x128" href="/icons/icon-128x128.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png" />
    <link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png" />
  </head>
  <body vocab="http://schema.org/">
    <style>
      html,
      body {
        padding: 0;
        margin: 0;
      }
      html {
        font-size: 18px;
      }
      @media (prefers-color-scheme: dark) {
        html {
          background: black;
          color: white;
        }
      }

      body {
        --swatch-grey-bg: white;
        --swatch-on-grey-bg: black;

        line-height: 1.5;
        font-family: 'Lato', sans-serif;
        font-size: 1rem;
        overscroll-behavior: contain;
        --edge-padding: 1.5rem;
        --header-height: 80px;
        --footer-height: 80px;
      }
      @supports (--foo: env(bar)) {
        body {
          --edge-padding: calc(1.5rem + env(safe-area-inset-left, 0) + env(safe-area-inset-right, 0));
          --header-height: calc(80px + env(safe-area-inset-top, 0));
          --footer-height: calc(80px + env(safe-area-inset-bottom, 0));
        }
      }
      @media (prefers-color-scheme: dark) {
        body {
          background: black;
          color: white;
          --swatch-grey-bg: #f0f0f0;
        }
      }
      [data-section="topstories"] {
        --swatch-section: #500F74;
        --swatch-section-accent: #CD00D8;
        --swatch-on-section: white;
      }
      [data-section="newstories"] {
        --swatch-section: #004BD8;
        --swatch-section-accent: #3078FF;
        --swatch-on-section: white;
      }
      [data-section="topstories"] [data-show-if]:not([data-show-if="topstories"]),
      [data-section="newstories"] [data-show-if]:not([data-show-if="newstories"]) {
        display: none;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      p {
        margin-top: 1rem;
      }
      h1 {
        font-size: 2.667rem;
        font-weight: 800;
        font-family: 'Kanit', sans-serif;
      }
      h2 {
        font-size: 2rem;
        line-height: 1.3;
        padding: 1rem var(--edge-padding);
        display: grid;
        text-transform: uppercase;
        grid-auto-flow: column;
        align-items: center;
        justify-content: flex-start;
        grid-gap: 1rem;
        background: var(--swatch-grey-bg);
        color: var(--swatch-on-grey-bg);
        font-weight: 800;
        font-family: 'Kanit', sans-serif;
      }
      h2:before {
        height: 1em;
        width: 1em;
        background: var(--swatch-section);
        content: '';
        display: inline-grid;
      }
      h3 {
        font-weight: 500;
        font-family: 'Kanit', sans-serif;
        font-size: 1.667rem;
        line-height: 1.3;
        padding-bottom: 1.5rem;
        padding-left: var(--edge-padding);
        padding-right: var(--edge-padding);
      }
      h4 {
        font-weight: 500;
        font-family: 'Kanit', sans-serif;
        display: inline-grid;
      }
      .header {
        position: fixed;
        top: 0;
        height: var(--header-height);
        width: 100%;
        display: grid;
        grid-auto-flow: column;
        justify-content: space-between;
        align-items: center;
        padding: 0 var(--edge-padding);
        background: var(--swatch-grey-bg);
        color: var(--swatch-section);
      }
      @supports (--foo: env(bar)) {
        .header {
          padding-top: env(safe-area-inset-top, 0);
        }
      }
      .main {
        margin-top: 80px;
        margin-bottom: 80px;
        background: var(--swatch-container);
      }
      @supports (--foo: env(bar)) {
        .main {
          margin-top: var(--header-height);
          margin-bottom: var(--footer-height);
        }
      }
      hn-icon {
        background: black;
        height: 1em;
        width: 1em;
        display: inline-grid;
      }
      .footer {
        position: fixed;
        background: #fefefe;
        border-top: 1px solid var(--swatch-grey-bg);
        bottom: 0;
        height: var(--footer-height);
        width: 100%;
        display: grid;
        grid-gap: 3rem;
        grid-auto-flow: column;
        grid-auto-columns: 1fr;
        align-items: center;
        padding: 0 var(--edge-padding);
      }
      @supports (--foo: env(bar)) {
        .footer {
          padding-bottom: env(safe-area-inset-bottom, 0);
        }
      }
      @media (prefers-color-scheme: dark) {
        .footer {
          background: black;
        }
      }
      .footer a {
        width: 100%;
        height: 100%;
        display: grid;
        justify-content: center;
        align-items: center;
        font-size: 1.25em;
        -webkit-tap-highlight-color: var(--swatch-section);
      }
      button {
        background: none;
        appearance: none;
        border: 0;
        border-radius: 0;
        padding: 0;
        font: inherit;
        line-height: inherit;
        color: inherit;
      }
      a {
        color: inherit;
        text-decoration: none;
      }
      .posting-meta {
        display: grid;
        grid-auto-flow: column;
        grid-gap: .5rem;
        justify-content: flex-start;
      }
      .visually-hidden {
        position: absolute; 
        overflow: hidden; 
        clip: rect(0 0 0 0); 
        height: 1px;
        width: 1px; 
        margin: -1px;
        padding: 0;
        border: 0; 
      }
    </style>
    
    <template id="top-comment-template">
      <style>
  
  * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        word-break: break-word;
      }
      p {
        margin-top: 1rem;
      }    
      hn-icon {
        background: black;
        height: 1em;
        width: 1em;
        display: inline-grid;
      }
        button {
          background: none;
          appearance: none;
          border: 0;
          border-radius: 0;
          padding: 0;
          font: inherit;
          line-height: inherit;
          color: inherit;
        }
        a {
          color: inherit;
          text-decoration: none;
        }

      
        .top-comment-meta {
          margin-bottom: .5rem;
        }

        .top-comment {
          padding: .5em var(--edge-padding);
        }
        .top-comment-footer {
          margin-top: 1rem;
        }
        .top-comment-total-count {
          font-weight: 500;
          font-family: 'Kanit', sans-serif;
        }</style>
      <aside class="top-comment" typeof="Comment" property="comment">
        <a data-url href="">
          <div class="top-comment-meta">
            <h4 class="top-comment-heading">
              Top Comment
            </h4>
            <span class="top-comment-author" property="author">
              <slot name="by"></slot>
            </span>
            <time class="top-comment-time" datetime="2020-01-01T14:12:11" property="dateCreated">
              <slot name="time"></slot>
            </time>
          </div>
          <div property="abstract">
            <slot name="text"></slot>
          </div>
          <div class="top-comment-meta top-comment-footer">
            <span class="top-comment-total-count"><slot name="descendants"></slot> Total Comments</span>
          </div>
        </a>
      </aside>
    </template>

    <template id="posting-template">
      <style>
        
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        word-break: break-word;
      }
      p {
        margin-top: 1rem;
      }
      h3 {
        font-weight: 500;
        font-family: 'Kanit', sans-serif;
        font-size: 1.667rem;
        line-height: 1.3;
        padding-bottom: 1.5rem;
        padding-left: var(--edge-padding);
        padding-right: var(--edge-padding);
      }
      h4 {
        font-weight: 500;
        font-family: 'Kanit', sans-serif;
        display: inline-grid;
      }
      hn-icon {
        background: black;
        height: 1em;
        width: 1em;
        display: inline-grid;
      }
        button {
          background: none;
          appearance: none;
          border: 0;
          border-radius: 0;
          padding: 0;
          font: inherit;
          line-height: inherit;
          color: inherit;
        }
        a {
          color: inherit;
          text-decoration: none;
        }

        .posting {
          padding-bottom: 3rem;
        }

        .posting-domain {
          display: grid;
          padding: 0 var(--edge-padding);
        }
        .posting-meta,
        .top-comment-meta {
          display: grid;
          grid-auto-flow: column;
          grid-gap: .5rem;
          justify-content: flex-start;
        }

        .posting-meta {
          font-size: .9em;
          background: var(--swatch-section);
          color: var(--swatch-on-section);
          padding: 1.5em var(--edge-padding) 0;
          border-top: 5px solid var(--swatch-section-accent);
        }
        .posting-main {
          margin-bottom: 1.5rem;
          display: grid;
          grid-gap: .5rem;
          background: var(--swatch-section);
          color: var(--swatch-on-section);
        }
        .visually-hidden {
          position: absolute; 
          overflow: hidden; 
          clip: rect(0 0 0 0); 
          height: 1px;
          width: 1px; 
          margin: -1px;
          padding: 0;
          border: 0; 
        }
      </style>
      <article class="posting" typeof="SocialMediaPosting">
        <a data-url href="" class="posting-meta">
          <time class="posting-time" datetime="2020-01-01T14:12:11" property="dateCreated">
            <slot name="time"></slot>
          </time>
          <span class="posting-submitter" property="author">
            <slot name="by"></slot>
          </span>
          <div class="posting-interaction" typeof="InteractionCounter" property="interactionStatistic">
            <span class="posting-interaction-count" property="userInteractionCount">
              <slot name="score"></slot>
            </span>
            <data property="interactionType" value="LikeAction">
              points
            </data>
          </div>
        </a>
        <div class="posting-content" property="sharedContent" typeof="Article">
          <a data-url class="posting-main" href="">
            <h3 class="posting-headline" property="headline">
              <slot name="title"></slot>
            </h3>
          </a>
          <slot name="top-comment"></slot>
        </div>
      </article>
    </template>

    <script>
      window.customElements.define('top-comment', class extends HTMLElement {
        constructor() {
          super()
        }
        static get observedAttributes() {
          return [
            'id',
            'by',
            'text',
            'score',
            'descendants',
            'time',
            'type',
            'url'
          ]
        }
        get id() {
          return this.getAttribute('id');
        }
        set id(value) {
          if (this.getAttribute('id') != value) {
            this.setAttribute('id', value)
          }
        }
        get by() {
          return this.getAttribute('by')
        }
        set by(value) {
          if (this.getAttribute('by') != value) {
            this.setAttribute('by', value)
          }
        }
        get score() {
          return this.getAttribute('score')
        }
        set score(value) {
          alert('...')
          if (this.getAttribute('score') != value) {
            this.setAttribute('score', value)
          }
        }
        get time() {
          return this.getAttribute('time')
        }
        set time(value) {
          const date = new Date(Date(value)).toLocaleString().split(', ')[1]
          if (this.getAttribute('time') != date) {
            this.setAttribute('time', date)
          }
        }
        get text() {
          return this.getAttribute('text')
        }
        set text(value) {
          const text = value.slice(0, 250) + (value.length > 250 ? '...' : '')
          if (this.getAttribute('text') != text) {
            this.setAttribute('text', text)
          }
        }
        get type() {
          return this.getAttribute('type')
        }
        set type(value) {
          if (this.getAttribute('type') != value) {
            this.setAttribute('type', value)
          }
        }
        get descendants() {
          return this.getAttribute('descendants')
        }
        set descendants(value) {
          if (this.getAttribute('descendants') != value) {
            this.setAttribute('descendants', value)
          }
        }
        get url() {
          return this.getAttribute('url')
        }
        set url(value) {
          if (this.getAttribute('url') != value) {
            this.setAttribute('url', value)
            ;[...this.shadowRoot.querySelectorAll('[data-url]')].forEach(element => {
              element.setAttribute('href', value)
            })
          }
        }
        attributeChangedCallback(name, oldValue, value) {
          this[name] = value
          const element = this.querySelector(`[slot="${name}"]`)
          if (element) {
            if (name === 'text') {
              element.innerHTML = value 
            } else if (element.innerText !== value) {
              element.innerText = value
            }
          }
        }
        connectedCallback() {
          const template = window.document.getElementById('top-comment-template')
          this.attachShadow({ mode: 'open' })
          this.shadowRoot.appendChild(template.content.cloneNode(true))
        }
      })
      window.customElements.define('top-article', class extends HTMLElement {
        constructor() {
          super()
        }
        static get observedAttributes() {
          return [
            'id',
            'by',
            'descendants',
            'kids',
            'score',
            'time',
            'title',
            'type',
            'url'
          ]
        }
        get id() {
          return this.getAttribute('id');
        }
        set id(value) {
          if (this.getAttribute('id') != value) {
            this.setAttribute('id', value)
          }
        }
        get by() {
          return this.getAttribute('by')
        }
        set by(value) {
          if (this.getAttribute('by') != value) {
            this.setAttribute('by', value)
          }
        }
        get score() {
          return this.getAttribute('score')
        }
        set score(value) {
          if (this.getAttribute('score') != value) {
            this.setAttribute('score', value)
          }
        }
        get time() {
          return this.getAttribute('time')
        }
        set time(value) {
          const date = new Date(Date(value)).toLocaleString().split(', ')[1]
          if (this.getAttribute('time') != date) {
            this.setAttribute('time', date)
          }
        }
        get title() {
          return this.getAttribute('title')
        }
        set title(value) {
          if (this.getAttribute('title') != value) {
            this.setAttribute('title', value)
          }
        }
        get type() {
          return this.getAttribute('type')
        }
        set type(value) {
          if (this.getAttribute('type') != value) {
            this.setAttribute('type', value)
          }
        }
        get descendants() {
          return this.getAttribute('descendants')
        }
        set descendants(value) {
          if (this.getAttribute('descendants') != value) {
            this.setAttribute('descendants', value)
          }
        }
        get url() {
          return this.getAttribute('url')
        }
        set url(value) {
          if (this.getAttribute('url') != value) {
            this.setAttribute('url', value)
            ;[...this.shadowRoot.querySelectorAll('[data-url]')].forEach(element => {
              element.setAttribute('href', value)
            })
          }
        }
        set kids(value) {
          ;(async () => {
            const data = {
              ...(await fetch(`https://hacker-news.firebaseio.com/v0/item/${value[0]}.json`).then(res => res.json())) || {},
              descendants: this.descendants,
              url: `https://news.ycombinator.com/item?id=${this.id}`
            }
            const comment = window.document.createElement('top-comment')
            Object.entries(data).map(([ prop, value ]) => {
              const element = window.document.createElement('data')
              element.setAttribute('slot', prop)
              comment.append(element)
            })
            this.append(comment)
            comment.setAttribute('slot', 'top-comment')
            Object.assign(comment, data)
          })()
        }
        attributeChangedCallback(name, oldValue, value) {
          this[name] = value
          const element = this.querySelector(`[slot="${name}"]`)
          if (element) {
            if (name === 'text') {
              element.innerHTML = value 
            } else if (element.innerText !== value) {
              element.innerText = value
            }
          }
        }
        connectedCallback() {
          const template = window.document.getElementById('posting-template')
          this.attachShadow({ mode: 'open' })
          this.shadowRoot.appendChild(template.content.cloneNode(true))
        }
      })

      const data = {
        stories: [],
        _section: null,
        get section() {
          return this._section
        },
        set section(section) {
          this._section = section
          window.document.body.dataset.section = section
        }
      }
      window.data = data
      let isLoading = false

      data.section = 'topstories'
      data.refetch = async (type) => {
        if (!isLoading) {
          isLoading = true
          data.stories = await fetch(`https://hacker-news.firebaseio.com/v0/${type || data.section}.json`).then(res => res.json())
          data.stories = await Promise.all(data.stories.slice(0, 25).map(id => fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(res => res.json())))
          ;[...window.document.querySelectorAll('top-article')].forEach(el => el.remove())
          data.stories.forEach(post => {
            const article = window.document.createElement('top-article')
            Object.entries(post).map(([ prop, value ]) => {
              const element = window.document.createElement('data')
              element.setAttribute('slot', prop)
              element.innerText = value
              article.append(element)
            })
            window.document.getElementById('article-slot').append(article)
            Object.assign(article, post)
          })
          isLoading = false
        }
      }
      data.refetch()
      window.addEventListener('scroll', () => {
        if (window.scrollY < 0) {
          data.refetch()
        }
      })
      window.handleTopClick = async (e) => {
        e.preventDefault()
        await data.refetch('topstories')
        data.section = 'topstories'
      }
      window.handleLatestClick = async (e) => {
        e.preventDefault()
        await data.refetch('newstories')
        data.section = 'newstories'
      }
    </script>

    <div class="container">
      <header class="header">
        <h1>
          <span aria-hidden="true">HN</span>
          <span class="visually-hidden">Hacker News</span>
        </h1>
        <!--<nav>
          <button type="button" aria-label="Search" data-modal="search">
            <hn-icon glyph="search"></hn-icon>
          </button>
          <button type="button" aria-label="Submit" data-modal="submit">
            <hn-icon glyph="plus"></hn-icon>
          </button>
        </nav>-->
        Alpha
      </header>
      <main class="main">
        <section aria-label="Front Page">
          <h2 class="h2-top">
            <span data-show-if="topstories">Top Stories</span>
            <span data-show-if="newstories">New Stories</span>
          </h2>
          <div id="article-slot"></div>
        </section>
      </main>
      <nav class="footer">
        <a href="#" aria-label="Top Stories" onclick="handleTopClick(event)">
          Top<!--<hn-icon glyph="newspaper"></hn-icon>-->
        </a>
        <a href="#" aria-label="Latest" onclick="handleLatestClick(event)">
          Latest<!--<hn-icon glyph="list"></hn-icon>-->
        </a><!--
        <a href="/settings" aria-label="Settings">
          <hn-icon glyph="settings"></hn-icon>
        </a>-->
      </nav>
    </div>
  </body>
</html>